<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Adopt with Love</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
  <!-- Favicon -->
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/616/616408.png" type="image/png" />
</head>
<body class="d-flex flex-column min-vh-100">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="/" style="font-family: 'Poppins', sans-serif; font-weight: 400; font-size: 1.5rem;">
      Adopt with Love
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link px-3 py-2" href="/" style="font-weight: 400;">Inicio</a></li>
        <li class="nav-item"><a class="nav-link px-3 py-2" href="/fundaciones" style="font-weight: 400;">Fundaciones</a></li>
        <li class="nav-item"><a class="nav-link px-3 py-2" href="/tiendas" style="font-weight: 400;">Tiendas</a></li>
        <li class="nav-item"><a class="nav-link px-3 py-2" href="/login" style="font-weight: 400;">Inicio de sesión</a></li>
      </ul>
    </div>
  </nav>

  <!-- Formulario -->
  <div class="container d-flex justify-content-center align-items-center mt-3">
    <div class="card shadow w-75">
      <div th:if="${errorCorreo}" class="alert alert-danger" th:text="${errorCorreo}"></div>
      <div th:if="${errorRol}" class="alert alert-warning" th:text="${errorRol}"></div>
      <div th:if="${errorAutenticacion}" class="alert alert-danger" th:text="${errorAutenticacion}"></div>

      <div class="card-body">
        <h5 class="card-title text-center mb-2">Por favor digite la información para registrarse.</h5>

        <form id="registroForm" th:action="@{/registro}" method="post">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

          <div class="mb-3">
            <label for="tipoUsuario" class="form-label">Tipo de usuario</label>
            <select id="tipoUsuario" class="form-select" name="nombreRol" required>
              <option value="">Seleccione una opción</option>
              <option value="tienda">Vendedor</option>
              <option value="fundacion">Fundación</option>
            </select>
          </div>

          <!-- CAMPOS VENDEDOR -->
          <div id="camposTienda" style="display: none;">
            <input type="hidden" name="rol" value="vendedor" />
            <div class="mb-3"><label for="emailTienda" class="form-label">Correo Electrónico</label>
              <input type="email" class="form-control" id="emailTienda" name="email" required />
            </div>
            <div class="mb-3"><label for="nombreTienda" class="form-label">Nombre</label>
              <input type="text" class="form-control" id="nombreTienda" name="nombre" required />
            </div>
            <div class="mb-3"><label for="apellidoTienda" class="form-label">Apellido</label>
              <input type="text" class="form-control" id="apellidoTienda" name="apellido" required />
            </div>
            <div class="mb-3">
              <label for="telefonoTienda" class="form-label">Número de contacto</label>
              <input type="tel" class="form-control" id="telefonoTienda" name="contacto" 
                     pattern="[0-9]{10}" maxlength="10" 
                     title="Debe ingresar exactamente 10 dígitos" required />
              <small class="text-muted">Ingrese 10 dígitos</small>
            </div>
            <div class="mb-3">
              <label for="fechaNacimientoTienda" class="form-label">Fecha de nacimiento (debe ser mayor de 18 años)</label>
              <input type="date" class="form-control" id="fechaNacimientoTienda" name="fechaNacimiento" required />
            </div>
            <div class="mb-3">
              <label for="contrasenaTienda" class="form-label">Contraseña</label>
              <div class="input-group">
                <input type="password" class="form-control" id="contrasenaTienda" name="contrasena" required />
                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('contrasenaTienda')">
                  <i class="bi bi-eye" id="iconTienda"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- CAMPOS FUNDACIÓN -->
          <div id="camposFundacion" style="display: none;">
            <input type="hidden" name="rol" value="fundacion" />
            <div class="mb-3"><label for="emailFundacion" class="form-label">Correo Electrónico</label>
              <input type="email" class="form-control" id="emailFundacion" name="email" required />
            </div>
            <div class="mb-3"><label for="nombreFundacion" class="form-label">Nombre</label>
              <input type="text" class="form-control" id="nombreFundacion" name="nombre" required />
            </div>
            <div class="mb-3"><label for="apellidoFundacion" class="form-label">Apellido</label>
              <input type="text" class="form-control" id="apellidoFundacion" name="apellido" required />
            </div>
            <div class="mb-3">
              <label for="telefonoFundacion" class="form-label">Número de contacto</label>
              <input type="tel" class="form-control" id="telefonoFundacion" name="contacto" 
                     pattern="[0-9]{10}" maxlength="10" 
                     title="Debe ingresar exactamente 10 dígitos" required />
              <small class="text-muted">Ingrese 10 dígitos</small>
            </div>
            <div class="mb-3">
              <label for="fechaNacimientoFundacion" class="form-label">Fecha de nacimiento (debe ser mayor de 18 años)</label>
              <input type="date" class="form-control" id="fechaNacimientoFundacion" name="fechaNacimiento" required />
            </div>
            <div class="mb-3">
              <label for="contrasenaFundacion" class="form-label">Contraseña</label>
              <div class="input-group">
                <input type="password" class="form-control" id="contrasenaFundacion" name="contrasena" required />
                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('contrasenaFundacion')">
                  <i class="bi bi-eye" id="iconFundacion"></i>
                </button>
              </div>
            </div>
            <div class="mb-3"><label for="nit" class="form-label">NIT</label>
              <input type="text" class="form-control" id="nit" name="nit" required />
            </div>
            <div class="mb-3"><label for="nombreFund" class="form-label">Nombre de la Fundación</label>
              <input type="text" class="form-control" id="nombreFund" name="nombreFundacion" required />
            </div>
            <div class="mb-3"><label for="direccionFund" class="form-label">Dirección</label>
              <input type="text" class="form-control" id="direccionFund" name="direccion" required />
            </div>
            <div class="mb-3"><label for="correoFund" class="form-label">Correo de la Fundación</label>
              <input type="email" class="form-control" id="correoFund" name="correoFundacion" required />
            </div>
            <div class="mb-3">
              <label for="telefonoFund" class="form-label">Teléfono de la Fundación</label>
              <input type="tel" class="form-control" id="telefonoFund" name="telefonoFundacion" 
                     pattern="[0-9]{10}" maxlength="10" 
                     title="Debe ingresar exactamente 10 dígitos" required />
              <small class="text-muted">Ingrese 10 dígitos</small>
            </div>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="terminos" required />
            <label class="form-check-label" for="terminos">Acepto los términos y condiciones</label>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-primary">Registrarse</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const tipoUsuarioSelect = document.getElementById("tipoUsuario");
    const camposTienda = document.getElementById("camposTienda");
    const camposFundacion = document.getElementById("camposFundacion");

    // Función para alternar visibilidad de contraseña
    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      const icon = document.getElementById('icon' + inputId.replace('contrasena', ''));
      
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('bi-eye');
        icon.classList.add('bi-eye-slash');
      } else {
        input.type = 'password';
        icon.classList.remove('bi-eye-slash');
        icon.classList.add('bi-eye');
      }
    }

    // Función para calcular la fecha mínima (18 años atrás)
    function setMinAge() {
      const today = new Date();
      const minDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
      const maxDate = new Date(today.getFullYear() - 100, today.getMonth(), today.getDate());
      
      const fechaTienda = document.getElementById('fechaNacimientoTienda');
      const fechaFundacion = document.getElementById('fechaNacimientoFundacion');
      
      const minDateString = minDate.toISOString().split('T')[0];
      const maxDateString = maxDate.toISOString().split('T')[0];
      
      fechaTienda.max = minDateString;
      fechaTienda.min = maxDateString;
      fechaFundacion.max = minDateString;
      fechaFundacion.min = maxDateString;
    }

    function actualizarVisibilidadCampos() {
      const tipo = tipoUsuarioSelect.value;

      // Mostrar u ocultar secciones
      camposTienda.style.display = tipo === "tienda" ? "block" : "none";
      camposFundacion.style.display = tipo === "fundacion" ? "block" : "none";

      // Habilitar inputs visibles, deshabilitar los ocultos
      const inputsTienda = camposTienda.querySelectorAll("input");
      const inputsFundacion = camposFundacion.querySelectorAll("input");

      inputsTienda.forEach(input => {
        input.disabled = tipo !== "tienda";
        input.required = tipo === "tienda";
      });

      inputsFundacion.forEach(input => {
        input.disabled = tipo !== "fundacion";
        input.required = tipo === "fundacion";
      });
    }

    tipoUsuarioSelect.addEventListener("change", actualizarVisibilidadCampos);
    window.addEventListener("DOMContentLoaded", () => {
      actualizarVisibilidadCampos();
      setMinAge();
    });
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
